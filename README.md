# Telegram Stats Bot

Бот на aiogram для подсчёта активности пользователей в чатах. Добавляется в группы и незаметно ведёт статистику сообщений.

## Возможности

- Подсчёт сообщений каждого пользователя в чатах (сообщения ботов не учитываются).
- Хранение времени последней активности.
- **/stats** — личная статистика: всего сообщений и дата последнего сообщения.
- **/top** — топ-10 активных пользователей в чате (только для админов, ID задаются в конфиге).
- Логирование в файл `logs/bot.log`: вступление в группу, сообщения, ошибки.

## Структура проекта

```
bot/
  config.py          # конфигурация из .env / env
  main.py            # точка входа
  logging_config.py  # настройка логирования
  handlers/          # обработчики команд и сообщений
  database/          # работа с PostgreSQL
sql/
  schema_bot.sql     # схема таблицы для статистики
```

## Настройка

1. Скопируйте `.env.example` в `env` или `.env` и заполните:
   - `TELEGRAM_BOT_TOKEN` — токен от @BotFather
   - `ADMIN_IDS` — ID администраторов через запятую (для /top)
   - Параметры БД: `DB_HOST`, `DB_PORT`, `DB_NAME`, `DB_USER`, `DB_PASSWORD`

2. На удалённой PostgreSQL (alwaysdata.com) создайте базу и при необходимости выполните `sql/schema_bot.sql`. Таблица создаётся автоматически при первом запуске бота.

## Запуск

### Локально

```bash
pip install -r requirements.txt
python -m bot.main
```

### Docker

```bash
docker-compose up --build
```

Переменные берутся из файла `env` (или переименуйте в `.env` и укажите `env_file: .env` в `docker-compose.yml`). Логи сохраняются в каталог `./logs` на хосте.

## База данных

Используется таблица `user_chat_stats`: по паре (chat_id, user_id) хранятся счётчик сообщений и время последней активности. Текст сообщений не сохраняется.
